C51 COMPILER V6.12  11                                                                     02/08/2012 09:26:35 PAGE 1   


C51 COMPILER V6.12, COMPILATION OF MODULE 11
OBJECT MODULE PLACED IN .\11.OBJ
COMPILER INVOKED BY: F:\Èí¼þ\keil C\C51\BIN\C51.EXE .\11.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          //   Êª¶È20-90   ÎÂ¶È0-50		²ÉÑù¼ä¸ô1S				ÎÞÏßÄ£¿é°å
   2          #include<reg52.h>
   3          #include<intrins.h>
   4          #define uchar unsigned char
   5          #define uint unsigned int
   6          sbit DQ=P2^3;			 //DTH11
   7          // 1602
   8          sbit lcden=P3^7;
   9          sbit lcdrs=P3^4;
  10          sbit lcdrw=P3^6;
  11          sbit BELL=P1^6;
  12          uchar wendu;
  13          uchar shidu;
  14          ////////  12864
  15          void delay1ms(uint z)
  16          {
  17   1      	uint x,y;
  18   1      	for(x=z;x>0;x--)
  19   1      		for(y=114;y>0;y--);
  20   1      }
  21          void  write_com(uchar com)
  22          { 	
  23   1      	lcdrs=0;
  24   1      	P0=com;
  25   1      	delay1ms(1);
  26   1      	lcden=1;
  27   1      	delay1ms(1);
  28   1      	lcden=0;
  29   1      
  30   1      }
  31          void write_date(uchar date)
  32          {
  33   1      	lcdrs=1;
  34   1      	P0=date;
  35   1      	delay1ms(1);
  36   1      	lcden=1;
  37   1      	delay1ms(1);
  38   1      	lcden=0;
  39   1      }
  40          
  41          void write_str(uchar *str)  
  42          {  
  43   1       while(*str!='\0')  //Î´½áÊø   
  44   1       {  
  45   2        write_date(*str++);  
  46   2        delay1ms(5);  
  47   2       }  
  48   1      } 
  49          
  50          void write_pos(uchar x,uchar y)  //´ÓµÚXÐÐµÄµÚYÎ»ÖÃ¿ªÊ¼ÏÔÊ¾   
  51          {  
  52   1       uchar pos;  
  53   1       if(x==1)        //µÚÒ»ÐÐ   
  54   1       { x=0x80;}  
  55   1       else if(x==2)  //µÚ¶þÐÐ   
C51 COMPILER V6.12  11                                                                     02/08/2012 09:26:35 PAGE 2   

  56   1       { x=0x90;}  
  57   1       else if(x==3)  //µÚÈýÐÐ   
  58   1       { x=0x88;}  
  59   1       else if(x==4)  //µÚËÄÐÐ   
  60   1       { x=0x98;}  
  61   1       pos=x+y-1;     //Ê×µØÖ·Îª0X80   
  62   1       write_com(pos);  
  63   1      } 
  64          
  65          void init_12864()
  66          {	
  67   1      	lcdrw=0; 
  68   1      	lcden=0;
  69   1      	write_com(0x01);
  70   1      	delay1ms(5);
  71   1      	write_com(0x30);	
  72   1      	write_com(0x06);
  73   1      	write_com(0x0c);
  74   1      	write_com(0x88);
  75   1      	write_pos(1,1);
  76   1      	write_str("  ÎÂÊª¶È²âÁ¿ÊµÑéÆ");
  77   1      	write_pos(2,1);
  78   1      	write_str("»·¾³Êª¶È:");
  79   1      	write_pos(2,7);
  80   1      	write_str("%");
  81   1      	write_pos(3,1);
  82   1      	write_str("µ±Ç°ÎÂ¶È:");
  83   1      	write_pos(3,7);
  84   1          write_str("¶È");
  85   1      	write_pos(4,1);
  86   1      	write_str("  Ë³Í¨µç×Ó¹¤×÷ÊÒ§");
  87   1      
  88   1      }
  89          /////////  DTH11
  90          
  91          bit init_DTH11()
  92          {
  93   1      	bit flag;
  94   1      	uchar num;
  95   1      	DQ=0;
  96   1      	delay1ms(19);	  // >18ms
  97   1      	DQ=1;
  98   1      	for(num=0;num<10;num++);	  // 20-40us			 34.7us
  99   1      
 100   1      	for(num=0;num<12;num++);
 101   1      	flag=DQ;
 102   1      	for(num=0;num<11;num++);	//DTHÏìÓ¦80us
 103   1      
 104   1      	for(num=0;num<24;num++);   	//DTHÀ­¸ß80us
 105   1      	return flag;
 106   1      }
 107          
 108          uchar DTH11_RD_CHAR()
 109          {
 110   1      	uchar byte=0;
 111   1      	uchar num;
 112   1      	uchar num1;
 113   1      	while(DQ==1);
 114   1      	for(num1=0;num1<8;num1++)
 115   1      	{
 116   2      		while(DQ==0);
 117   2      		byte<<=1;			  //¸ßÎ»ÔÚÇ°
C51 COMPILER V6.12  11                                                                     02/08/2012 09:26:35 PAGE 3   

 118   2      		for(num=0;DQ==1;num++);
 119   2      		if(num<10)
 120   2      			byte|=0x00;
 121   2      		else 
 122   2      			byte|=0x01;
 123   2      	}
 124   1      	return byte;
 125   1      }
 126          void  DTH11_DUSHU()
 127          {
 128   1      	uchar num;
 129   1      	if(init_DTH11()==0)
 130   1      	{	
 131   2      		wendu=DTH11_RD_CHAR()-2;   //±ÈÕý³£Öµ¸ß2¶È×óÓÒ
 132   2      		DTH11_RD_CHAR();
 133   2      		shidu=DTH11_RD_CHAR();
 134   2      		DTH11_RD_CHAR();
 135   2      		DTH11_RD_CHAR();
 136   2      		for(num=0;num<17;num++);  //×îºóBITÊä³öºóÀ­µÍ×ÜÏß59us
 137   2      		DQ=1;
 138   2      		BELL=0;
 139   2      		delay1ms(1);
 140   2      		BELL=1;	
 141   2      	}
 142   1      }
 143          
 144          
 145          /////////
 146          
 147          main()
 148          {
 149   1      	wendu=0;
 150   1      	shidu=0;
 151   1      	delay1ms(1000);		  //DTH11¿ªÊ¼1sÓÐ´íÎóÊä³ö
 152   1      	init_12864();
 153   1      	while(1)
 154   1      	{
 155   2      		DTH11_DUSHU();
 156   2      		write_pos(2,6);
 157   2      		write_date(wendu/10%10+48);
 158   2      		write_date(wendu%10+48);
 159   2      		write_pos(3,6);
 160   2      		write_date(shidu/10%10+48);
 161   2      		write_date(shidu%10+48);
 162   2      		delay1ms(2000);
 163   2      	}
 164   1      
 165   1      
 166   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    467    ----
   CONSTANT SIZE    =     61    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
